def context_reduction(query: str) -> str:
    return """Сократи следующий текст/диалог до ключевых фактов и решений, сохранив:
    - Главные договорённости и выводы
    - Важные числа, даты, имена
    - Нерешённые вопросы
    - Текущий статус задачи

    Убери: приветствия, рассуждения, повторы, промежуточные варианты.

    Формат: сжатый список или краткое саммари.

    ТЕКСТ ДЛЯ СОКРАЩЕНИЯ:

    """ + query


def task_classification(query: str) -> str:
    return f"""Классифицируй запрос. Верни ТОЛЬКО JSON или текст. БЕЗ пояснений, БЕЗ markdown.

ДИАЛОГ:
{query}

!!! ГЛАВНОЕ ПРАВИЛО !!!
Если в диалоге есть "API response:" с результатом (например "API response: 2+2 = 4") — задача УЖЕ РЕШЕНА!
НЕ отправляй JSON снова! Верни ТЕКСТ с результатом!

ПРАВИЛА:
1. Есть "API response:" с ответом → верни ТЕКСТ с результатом (НЕ JSON!)
2. Пользователь ответил на вопрос → используй ответ, НЕ спрашивай снова
3. Собирай данные из ВСЕХ сообщений "User:" в истории

ТИПЫ ЗАДАЧ (возвращай JSON только если задача НЕ решена):

1) TSP: {{"task_id":1,"data":{{"cities":[...],"distances":[{{"from":"A","to":"B","distance":10}}]}}}}
2) Клика: {{"task_id":2,"data":{{"vertices":[...],"edges":[["v1","v2"]]}}}}
3) Рюкзак: {{"task_id":3,"data":{{"max_weight":50,"items":[{{"name":"X","weight":10,"value":5}}]}}}}
4) Арифметика: {{"task_id":4,"data":{{"expression":"2+2"}}}}
5) Другое → текст

ПРИМЕРЫ:

Вход: "User: 2+2"
Выход: {{"task_id":4,"data":{{"expression":"2+2"}}}}

Вход: "User: 2+2
GigaChat request: [Task: Arithmetic, id=4]
API response: 2+2 = 4"
Выход: Результат: 2+2 = 4

Вход: "User: 100*5
GigaChat request: [Task: Arithmetic, id=4]
API response: 100*5 = 500
User: спасибо"
Выход: Пожалуйста! Результат: 500

Вход: "User: сколько будет 3456 + 54
GigaChat request: [Task: Arithmetic, id=4]
API response: 3456+54 = 3510"
Выход: Ответ: 3456 + 54 = 3510

ТВОЙ ОТВЕТ (JSON если задача НЕ решена, ТЕКСТ если решена):"""
