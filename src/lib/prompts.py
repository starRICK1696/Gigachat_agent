def context_reduction(query: str) -> str:
    return """Сократи следующий текст/диалог до ключевых фактов и решений, сохранив:
    - Главные договорённости и выводы
    - Важные числа, даты, имена
    - Нерешённые вопросы
    - Текущий статус задачи

    Убери: приветствия, рассуждения, повторы, промежуточные варианты.

    Формат: сжатый список или краткое саммари.

    ТЕКСТ ДЛЯ СОКРАЩЕНИЯ:

    """ + query


def task_classification(query: str) -> str:
    return f"""
    Ты — эксперт по анализу и структурированию задач. Твоя цель: классифицировать запрос пользователя и извлечь из него данные в строгом формате JSON для последующего решения.

    Запрос пользователя:
    '{query}'

    Проанализируй текст и выбери один из следующих вариантов. Верни ответ ТОЛЬКО в формате JSON, соответствующем выбранному типу.

    ВАРИАНТЫ ЗАДАЧ И ФОРМАТЫ ОТВЕТА:

    1) **Задача коммивояжера (TSP)**
    Описание: Дано n городов и расстояния между ними. Найти кратчайший замкнутый маршрут.
    Формат JSON:
    {{
        "task_id": 1,
        "data": {{
            "cities": ["Город А", "Город Б", ...],
            "distances": [
                {{"from": "Город А", "to": "Город Б", "distance": 10}},
                ...
            ]
        }}
    }}

    2) **Поиск максимальной клики**
    Описание: В графе найти максимальное подмножество вершин, где все вершины соединены друг с другом.
    Формат JSON:
    {{
        "task_id": 2,
        "data": {{
            "vertices": ["v1", "v2", ...],
            "edges": [["v1", "v2"], ["v3", "v4"], ...]
        }}
    }}

    3) **Задача о рюкзаке**
    Описание: Есть вместимость W и предметы с весом и стоимостью. Максимизировать стоимость при ограничении веса.
    Формат JSON:
    {{
        "task_id": 3,
        "data": {{
            "max_weight": 50,
            "items": [
                {{"name": "Предмет 1", "weight": 10, "value": 5}},
                {{"name": "Предмет 2", "weight": 2, "value": 20}}
            ]
        }}
    }}

    4) **Арифметические операции**
    Описание: Выражение, которое можно вычислить (например, python eval).
    Формат JSON:
    {{
        "task_id": 4,
        "data": {{
            "expression": "2 + 2 * 2"
        }}
    }}

    5) **Неизвестная задача**
    Описание: Ни одна из вышеперечисленных категорий не подходит.
    В таком случае просто верни ответ на запрос в поле data
    Формат JSON:
    {{
        "task_id": 5,
        "data": "Твой текст"
    }}

    ТРЕБОВАНИЯ:
    - В ответе должен быть ТОЛЬКО валидный JSON. Без пояснений и markdown-разметки (```json).
    - Извлеки все числовые значения и сущности из текста запроса в соответствующие поля `data`.
    - Если в запросе уже есть задача, которая была решена, не пытайся решить ее снова
    """
